# title

## 场景

### 同一个请求发送多次，如何保证获取最后一次结果？

同一个请求发送多次,保证获取最后一次结果的具体方法主要有以下3种

1. 服务器端设置缓存时间,在此时间内返回缓存结果
    - 服务器可以设置一个缓存时间,比如3秒钟,在这个时间窗口内,对同一个请求返回缓存的结果。
    - 客户端发送重复请求的间隔大于这个缓存时间,这样就可以获取最新的结果了。
    - 例如,服务端缓存时间设置3秒,客户端设置请求重复间隔5秒。那么第1次请求获取结果并缓存3秒,第2次请求会再次获取最新结果,因间隔大于缓存时间。
    - 这种方式简单易实现,但是缓存时间设置过长会影响结果的实时性,过短会产生许多不必要请求。

2. 服务器端根据请求的唯一标识判断是否重复请求

    - 服务端可以根据请求中的某个唯一标识,比如用户ID、SessionID等,来判断是否是重复请求。
    - 如果是重复请求,则直接返回最新结果。如果不是,则正常执行逻辑并返回结果。
    - 这种方式可以避免设置缓存时间,并且重复请求不会产生额外负载,但是需要服务端对请求进行判断与处理,实现稍微复杂。

3. 采用版本号或时间戳验证方式

    - 服务端在响应结果中加入版本号或时间戳信息。
    - 客户端发送请求时传递自己保存的版本号或时间戳。
    - 服务端对比信息,如果客户端所传版本号或时间戳过期,则返回最新结果,否则直接返回304未修改。
    - 这种方式可以避免设置缓存时间,同时也不需要服务端判断是否重复请求,比较轻量级和可靠。但是需要在请求与响应中加入版本验证信息,稍微增加流量。

以上3种方法各有优缺点,可以根据实际场景选择合适的方案。一般来说,版本号或时间戳验证方式更轻量级可靠,是使用比较广泛的方案。但如果请求结果变化频繁,会产生较多304未修改响应,效率稍低。
